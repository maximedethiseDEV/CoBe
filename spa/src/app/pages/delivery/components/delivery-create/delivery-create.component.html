<app-header-form [iconHeader]="iconHeader" [labelHeader]="labelHeader"/>

<div class="mt-6 flex-1">
    <form
        [formGroup]="form"
        (ngSubmit)="create()"
    >
        <div class="border border-slate-200 divide-y divide-slate-200 rounded-none">
            <app-section-fom
                [sectionForm]="sections.order"
            >
                <ng-container slot="content">
                    <label for="purchaseOrder" class="block text-sm font-medium text-slate-700">
                        Commande liée
                    </label>
                    <select
                        id="purchaseOrder"
                        formControlName="orderId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (purchaseOrder of purchaseOrders(); track purchaseOrder.id) {
                            <option [ngValue]="purchaseOrder.id">
                                [{{ purchaseOrder.id }}] {{ purchaseOrder.codeAS400 }} - {{ purchaseOrder.customerName }} - {{ purchaseOrder.constructionSiteCityName }}
                            </option>
                        }
                    </select>

                    <label for="deliveryOrderNumber" class="mt-4 block text-sm font-medium text-slate-700">
                        Numéro de chargement
                    </label>
                    <select
                        id="deliveryOrderNumber"
                        formControlName="deliveryOrderNumberId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]=""></option>
                        @for (deliveryOrderNumber of deliveryOrderNumbers(); track deliveryOrderNumber.id) {
                            <option [ngValue]="deliveryOrderNumber.id">
                                {{ deliveryOrderNumber.uniqueDeliveryOrderNumber }}
                            </option>
                        }
                    </select>
                </ng-container>
            </app-section-fom>

            <app-section-fom [sectionForm]="sections.transport"
            >
                <ng-container slot="content">
                    <label for="transportSupplier" class="block text-sm font-medium text-slate-700">
                        Transporteur
                    </label>
                    <select
                        id="transportSupplier"
                        formControlName="transportSupplierId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (transportSupplier of transportSuppliers(); track transportSupplier.id) {
                            <option [ngValue]="transportSupplier.id">
                                {{ transportSupplier.companyName}}
                            </option>
                        }
                    </select>

                    <label for="status" class="mt-4 block text-sm font-medium text-slate-700">
                        Statut
                    </label>
                    <select
                        id="status"
                        formControlName="statusId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (status of deliveryStatus(); track status.id) {
                            <option [ngValue]="status.id">
                                {{ status.name }}
                            </option>
                        }
                    </select>
                </ng-container>
            </app-section-fom>

            <app-section-fom [sectionForm]="sections.schedule">
                <ng-container slot="content">
                    <label for="actualDeliveryBegin" class="block text-sm font-medium text-slate-700">
                        Début de livraison <span class="text-indigo-600">*</span>
                    </label>
                    <input
                        id="actualDeliveryBegin"
                        type="datetime-local"
                        formControlName="actualDeliveryBegin"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                    @if (form.get('actualDeliveryBegin')?.invalid && (form.get('actualDeliveryBegin')?.touched || form.get('actualDeliveryBegin')?.dirty)) {
                        <p class="mt-1 text-xs text-rose-600">Champ requis</p>
                    }

                    <label for="actualDeliveryEnd" class="mt-4 block text-sm font-medium text-slate-700">
                        Fin de livraison
                    </label>
                    <input
                        id="actualDeliveryEnd"
                        type="datetime-local"
                        formControlName="actualDeliveryEnd"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >

                    <label for="quantity" class="mt-4 block text-sm font-medium text-slate-700">
                        Quantité <span class="text-indigo-600">*</span>
                    </label>
                    <input
                        id="quantity"
                        type="number"
                        formControlName="quantity"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                    @if (form.get('quantity')?.invalid && (form.get('quantity')?.touched || form.get('quantity')?.dirty)) {
                        <p class="mt-1 text-xs text-rose-600">Champ requis</p>
                    }
                </ng-container>
            </app-section-fom>

            <app-section-fom
                [sectionForm]="sections.sharedDetails"
                (createConfig)="onSectionCreateModeChange($event)"
            >
                <ng-container slot="isNew">
                    <app-shared-details-form [form]="form"/>
                </ng-container>
                <ng-container slot="content">
                    <label for="sharedDetail" class="block text-sm font-medium text-slate-700">
                        Détails
                    </label>
                    <select
                        id="sharedDetail"
                        formControlName="sharedDetailsId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (sharedDetail of sharedDetails(); track sharedDetail.id) {
                            <option [ngValue]="sharedDetail.id">
                                {{ sharedDetail.fileName}} {{ sharedDetail.notes}}
                            </option>
                        }
                    </select>
                </ng-container>
            </app-section-fom>
        </div>

        <div class="mt-4 flex justify-end">
            <app-submit-button [disabled]="form.invalid"/>
        </div>
    </form>
</div>
