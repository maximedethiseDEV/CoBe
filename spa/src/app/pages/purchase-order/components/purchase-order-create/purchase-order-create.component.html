<app-header-form [iconHeader]="iconHeader" [labelHeader]="labelHeader"/>

<div class="mt-6 flex-1">
    <form
        [formGroup]="form"
        (ngSubmit)="create()"
    >
        <div class="border border-slate-200 divide-y divide-slate-200 rounded-none">
            <app-section-fom
            [sectionForm]="sections.customer"
        >
            <ng-container slot="content">
                <label for="customer" class="block text-sm font-medium text-slate-700">
                    Client à livrer
                </label>
                <select
                    id="customer"
                    formControlName="customerId"
                    class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                >
                    <option [ngValue]="null"></option>
                    @for (customer of customers(); track customer.id) {
                        <option [ngValue]="customer.id">
                            {{ customer.companyName }}
                        </option>
                    }
                </select>
            </ng-container>
        </app-section-fom>

            <app-section-fom
                [sectionForm]="sections.constructionSite"
            >
                <ng-container slot="content">
                    <label for="constructionSite" class="block text-sm font-medium text-slate-700">
                        Choix chantier
                    </label>
                    <select
                        id="constructionSite"
                        formControlName="constructionSiteId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (constructionSite of constructionSites(); track constructionSite.id) {
                            <option [ngValue]="constructionSite.id">
                                {{ constructionSite.companyName }} - {{ constructionSite.street}} {{ constructionSite.cityName}} - {{constructionSite.postalCode}} - {{constructionSite.countryCode}}
                            </option>
                        }
                    </select>
                </ng-container>
            </app-section-fom>

            <app-section-fom
                [sectionForm]="sections.product"
            >
                <ng-container slot="content">
                    <label for="quantityOrdered" class="block text-sm font-medium text-slate-700">
                        Quantité <span class="text-indigo-600">*</span>
                    </label>
                    <input
                        id="quantityOrdered"
                        type="number"
                        formControlName="quantityOrdered"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                    @if (form.get('quantityOrdered')?.invalid && (form.get('quantityOrdered')?.touched || form.get('quantityOrdered')?.dirty)) {
                        <p class="mt-1 text-xs text-rose-600">Champ requis</p>
                    }

                    <label for="product" class="mt-4 block text-sm font-medium text-slate-700">
                        Produit <span class="text-indigo-600">*</span>
                    </label>
                    <select
                        id="product"
                        formControlName="productId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="''"></option>
                        @for (product of products(); track product.id) {
                            <option [ngValue]="product.id">
                                {{product.codeAS400}} - {{product.nameShort}} ({{product.companyName}})
                            </option>
                        }
                    </select>
                    @if (form.get('productId')?.invalid && (form.get('productId')?.touched || form.get('productId')?.dirty)) {
                        <p class="mt-1 text-xs text-rose-600">Champ requis</p>
                    }
                </ng-container>
            </app-section-fom>

            <app-section-fom
                [sectionForm]="sections.schedule"
            >
                <ng-container slot="content">
                    <label for="requestedDeliveryBegin" class="mt-4 block text-sm font-medium text-slate-700">
                        Début de livraison souhaité <span class="text-indigo-600">*</span>
                    </label>
                    <input
                        id="requestedDeliveryBegin"
                        type="datetime-local"
                        formControlName="requestedDeliveryBegin"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >

                    <label for="requestedDeliveryEnd" class="mt-4 block text-sm font-medium text-slate-700">
                        Fin de livraison souhaitée
                    </label>
                    <input
                        id="requestedDeliveryEnd"
                        type="datetime-local"
                        formControlName="requestedDeliveryEnd"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                </ng-container>
            </app-section-fom>

            <app-section-fom
                [sectionForm]="sections.sharedDetails"
                (createConfig)="onSectionCreateModeChange($event)"
            >
                <ng-container slot="isNew">
                    <app-shared-details-form [form]="form"/>
                </ng-container>
                <ng-container slot="content">
                    <label for="sharedDetail" class="block text-sm font-medium text-slate-700">
                        Détails
                    </label>
                    <select
                        id="sharedDetail"
                        formControlName="sharedDetailsId"
                        class="mt-1 block w-full bg-white px-3 py-2 text-sm text-slate-900 border border-slate-300 outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition"
                    >
                        <option [ngValue]="null"></option>
                        @for (sharedDetail of sharedDetails(); track sharedDetail.id) {
                            <option [ngValue]="sharedDetail.id">
                                {{ sharedDetail.fileName}} {{ sharedDetail.notes}}
                            </option>
                        }
                    </select>
                </ng-container>
            </app-section-fom>
        </div>

        <div class="mt-4 flex justify-end">
            <app-submit-button [disabled]="form.invalid"/>
        </div>
    </form>
</div>
